<!DOCTYPE html>
<html lang="pt-br">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Dashboard DRE - Outubro</title>
    <!-- Carrega o Tailwind CSS da CDN -->
    <script src="https://cdn.tailwindcss.com"></script>
    <style>
        body { font-family: 'Inter', sans-serif; }
        .data-item {
            display: flex;
            justify-content: space-between;
            align-items: center;
            padding: 0.75rem 0;
            border-bottom: 1px solid #e5e7eb;
            transition: background 0.2s;
        }
        .data-item:hover {
            background: #f1f5f9;
        }
        .data-item:last-child { border-bottom: none; }
        .data-label { font-size: 0.875rem; color: #475569; }
        .data-value { font-size: 0.875rem; font-weight: 600; color: #1e293b; }
        .kpi-card {
            background-color: #f8fafc;
            border-radius: 0.5rem;
            padding: 1rem;
            text-align: center;
            transition: transform 0.2s, box-shadow 0.2s, background 0.2s;
            cursor: pointer;
        }
        .kpi-card:hover {
            transform: translateY(-4px) scale(1.03);
            box-shadow: 0 8px 32px 0 rgba(59,130,246,0.10), 0 1.5px 6px 0 rgba(0,0,0,0.04);
            background: #e0e7ef;
        }
        /* Efeito nos cards de distribuição de salários */
        .bg-slate-50.p-4.rounded-lg.border.border-slate-100.flex.justify-between.items-center {
            transition: box-shadow 0.2s, transform 0.2s, background 0.2s;
            cursor: pointer;
        }
        .bg-slate-50.p-4.rounded-lg.border.border-slate-100.flex.justify-between.items-center:hover {
            box-shadow: 0 8px 32px 0 rgba(139,92,246,0.10), 0 1.5px 6px 0 rgba(0,0,0,0.04);
            background: #ede9fe;
            transform: translateY(-2px) scale(1.02);
        }
        .kpi-label {
            display: flex;
            align-items: center;
            justify-content: center;
            font-size: 0.875rem;
            font-weight: 500;
            color: #475569;
            margin-bottom: 0.25rem;
        }
        .kpi-label svg { width: 1rem; height: 1rem; margin-right: 0.5rem; color: #64748b; }
        .kpi-value { font-size: 1.5rem; font-weight: 700; color: #0f172a; }
        
        /* Spinner */
        .loading-spinner {
            border: 4px solid #f3f4f6;
            border-top: 4px solid #3b82f6;
            border-radius: 50%;
            width: 2rem;
            height: 2rem;
            animation: spin 1s linear infinite;
            margin: 1rem auto;
        }
        @keyframes spin { 0% { transform: rotate(0deg); } 100% { transform: rotate(360deg); } }
    </style>
</head>
<body class="bg-slate-100 p-4 sm:p-6 lg:p-8">

    <div class="max-w-7xl mx-auto">
        <!-- Header -->
        <div class="flex flex-col md:flex-row justify-between items-start md:items-center mb-6 gap-4">
            <div>
                <h1 class="text-3xl font-bold text-slate-900">DRE - Mês de Outubro</h1>
                <p class="text-slate-500 text-sm mt-1">Demonstrativo do Resultado do Exercício</p>
            </div>
            <div class="bg-green-100 text-green-800 px-4 py-2 rounded-lg font-semibold text-sm">
                Caixa Final: R$ 2.000,00
            </div>
        </div>

        <!-- Grid Principal -->
        <div class="grid grid-cols-1 lg:grid-cols-3 gap-6">

            <!-- Card 1: Vendas e Margem -->
            <div class="lg:col-span-1 bg-white rounded-xl shadow-lg overflow-hidden">
                <div class="p-6">
                    <h2 class="text-2xl font-semibold text-blue-700 mb-5">Vendas & Margem</h2>
                    
                    <div class="grid grid-cols-1 gap-4 mb-5">
                        <div class="kpi-card">
                            <div class="kpi-label">
                                <svg xmlns="http://www.w3.org/2000/svg" fill="none" viewBox="0 0 24 24" stroke-width="1.5" stroke="currentColor"><path stroke-linecap="round" stroke-linejoin="round" d="M12 6v12m-3-2.818l.879.659c1.171.879 3.07.879 4.242 0l.879-.659M12 6a4.5 4.5 0 00-1.757 8.828l.879.659c1.171.879 3.07.879 4.242 0l.879-.659A4.5 4.5 0 0012 6z" /></svg>
                                Receita Bruta
                            </div>
                            <div class="kpi-value">R$ 9.800,00</div>
                        </div>
                    </div>
                    
                    <div class="divide-y divide-slate-200">
                        <div class="data-item">
                            <span class="data-label">(-) Descontos/Estornos</span>
                            <span class="data-value">R$ 0,00</span>
                        </div>
                        <div class="data-item">
                            <span class="data-label">Receita Líquida</span>
                            <span class="data-value font-bold">R$ 9.800,00</span>
                        </div>
                        <div class="data-item">
                            <span class="data-label">(-) CPV (Custo Produtos)</span>
                            <span class="data-value text-red-600">(R$ 3.800,00)</span>
                        </div>
                        <div class="data-item bg-slate-50 -mx-6 px-6 mt-2">
                            <span class="data-label font-bold text-slate-700">Lucro Bruto</span>
                            <span class="data-value text-blue-600 text-lg">R$ 6.000,00</span>
                        </div>
                    </div>
                </div>
            </div>

            <!-- Card 2: Despesas Operacionais -->
            <div class="lg:col-span-1 bg-white rounded-xl shadow-lg overflow-hidden">
                <div class="p-6">
                    <h2 class="text-2xl font-semibold text-red-700 mb-5">Despesas Operacionais</h2>

                    <div class="grid grid-cols-1 gap-4 mb-5">
                        <div class="kpi-card bg-red-50">
                            <div class="kpi-label text-red-600">
                                <svg xmlns="http://www.w3.org/2000/svg" fill="none" viewBox="0 0 24 24" stroke-width="1.5" stroke="currentColor"><path stroke-linecap="round" stroke-linejoin="round" d="M19.5 13.5L12 21m0 0l-7.5-7.5M12 21V3" /></svg>
                                Total Despesas
                            </div>
                            <div class="kpi-value text-red-700">R$ 4.000,00</div>
                        </div>
                    </div>
                    
                    <div class="divide-y divide-slate-200">
                        <div class="data-item">
                            <span class="data-label">Frete Semanal (4x R$50)</span>
                            <span class="data-value">R$ 200,00</span>
                        </div>
                        <div class="data-item">
                            <span class="data-label">Materiais Extras (Sacolas, etc)</span>
                            <span class="data-value">R$ 200,00</span>
                        </div>
                        <div class="data-item">
                            <span class="data-label">Total Salários Fixos</span>
                            <span class="data-value">R$ 3.600,00</span>
                        </div>
                        <div class="pt-4 text-xs text-slate-400 text-center italic">
                            Ver distribuição detalhada abaixo
                        </div>
                    </div>
                </div>
            </div>

            <!-- Card 3: Resultado Final -->
            <div class="lg:col-span-1 bg-white rounded-xl shadow-lg overflow-hidden">
                <div class="p-6">
                    <h2 class="text-2xl font-semibold text-green-700 mb-5">Resultado Final</h2>
                    
                    <div class="grid grid-cols-1 gap-4 mb-5">
                        <div class="kpi-card bg-green-50">
                            <div class="kpi-label text-green-600">
                                <svg xmlns="http://www.w3.org/2000/svg" fill="none" viewBox="0 0 24 24" stroke-width="1.5" stroke="currentColor"><path stroke-linecap="round" stroke-linejoin="round" d="M2.25 18L9 11.25l4.306 4.307a11.95 11.95 0 015.814-5.519l2.74-1.22m0 0l-5.94-2.28m5.94 2.28l-2.28 5.941" /></svg>
                                Lucro Líquido
                            </div>
                            <div class="kpi-value text-green-700">R$ 2.000,00</div>
                        </div>
                    </div>
                    
                    <div class="divide-y divide-slate-200">
                        <div class="data-item">
                            <span class="data-label">Lucro Operacional</span>
                            <span class="data-value">R$ 2.000,00</span>
                        </div>
                        <div class="data-item">
                            <span class="data-label">(-) Impostos</span>
                            <span class="data-value">R$ 0,00</span>
                        </div>
                        <div class="data-item bg-green-50 -mx-6 px-6 mt-2 py-4">
                            <span class="data-label font-bold text-green-800">Destino Caixa da Empresa</span>
                            <span class="data-value font-bold text-green-800 text-lg">R$ 2.000,00</span>
                        </div>
                    </div>
                </div>
            </div>

            <!-- Card: Distribuição de Salários (Ênfase) -->
            <div class="lg:col-span-3 bg-white rounded-xl shadow-lg overflow-hidden">
                <div class="p-6">
                    <div class="flex items-center mb-5">
                        <h2 class="text-2xl font-semibold text-purple-700">Distribuição de Salários Fixos</h2>
                        <span class="ml-4 bg-purple-100 text-purple-800 text-xs font-medium px-2.5 py-0.5 rounded">Total: R$ 3.600,00</span>
                    </div>
                    
                    <div class="grid grid-cols-1 sm:grid-cols-2 lg:grid-cols-3 gap-4">
                        <!-- Item -->
                        <div class="bg-slate-50 p-4 rounded-lg border border-slate-100 flex justify-between items-center">
                            <div>
                                <p class="text-sm text-slate-500">Administrativo</p>
                                <p class="font-bold text-slate-800">Maycon</p>
                            </div>
                            <div class="text-purple-700 font-bold">R$ 600,00</div>
                        </div>
                        <!-- Item -->
                        <div class="bg-slate-50 p-4 rounded-lg border border-slate-100 flex justify-between items-center">
                            <div>
                                <p class="text-sm text-slate-500">TI</p>
                                <p class="font-bold text-slate-800">Pierry</p>
                            </div>
                            <div class="text-purple-700 font-bold">R$ 600,00</div>
                        </div>
                        <!-- Item -->
                        <div class="bg-slate-50 p-4 rounded-lg border border-slate-100 flex justify-between items-center">
                            <div>
                                <p class="text-sm text-slate-500">Financeiro</p>
                                <p class="font-bold text-slate-800">Bernardo</p>
                            </div>
                            <div class="text-purple-700 font-bold">R$ 600,00</div>
                        </div>
                        <!-- Item -->
                        <div class="bg-slate-50 p-4 rounded-lg border border-slate-100 flex justify-between items-center">
                            <div>
                                <p class="text-sm text-slate-500">Operacional</p>
                                <p class="font-bold text-slate-800">Fernanda</p>
                            </div>
                            <div class="text-purple-700 font-bold">R$ 600,00</div>
                        </div>
                        <!-- Item -->
                        <div class="bg-slate-50 p-4 rounded-lg border border-slate-100 flex justify-between items-center">
                            <div>
                                <p class="text-sm text-slate-500">RH</p>
                                <p class="font-bold text-slate-800">Diogo</p>
                            </div>
                            <div class="text-purple-700 font-bold">R$ 600,00</div>
                        </div>
                        <!-- Item -->
                        <div class="bg-slate-50 p-4 rounded-lg border border-slate-100 flex justify-between items-center">
                            <div>
                                <p class="text-sm text-slate-500">Marketing</p>
                                <p class="font-bold text-slate-800">Marcos</p>
                            </div>
                            <div class="text-purple-700 font-bold">R$ 600,00</div>
                        </div>
                    </div>
                </div>
            </div>

            <!-- Card: Análise IA -->
            <div class="lg:col-span-3 bg-white rounded-xl shadow-lg overflow-hidden">
                <div class="p-6">
                    <div class="flex flex-col sm:flex-row justify-between sm:items-center gap-4">
                        <h2 class="text-2xl font-semibold text-indigo-700">Análise do DRE (IA)</h2>
                        <button id="generate-analysis-btn" class="w-full sm:w-auto bg-indigo-600 hover:bg-indigo-700 text-white font-bold py-2 px-4 rounded-lg transition-colors duration-200 focus:outline-none focus:ring-2 focus:ring-indigo-500 focus:ring-opacity-50">
                            Gerar Análise Financeira
                        </button>
                    </div>
                    <div class="mt-4 pt-4 border-t border-slate-200">
                        <div id="loading-spinner" class="loading-spinner hidden"></div>
                        <div id="analysis-result" class="text-slate-700 text-sm leading-relaxed prose prose-sm max-w-none">
                            <p class="text-slate-500">Clique no botão acima para gerar uma análise detalhada deste DRE.</p>
                        </div>
                    </div>
                </div>
            </div>

        </div> <!-- Fim do Grid -->
    </div>

    <!-- Script Gemini -->
    <script type="module">
        const generateBtn = document.getElementById('generate-analysis-btn');
        const loadingSpinner = document.getElementById('loading-spinner');
        const analysisResultDiv = document.getElementById('analysis-result');

        const apiKey = ""; 
        const apiUrl = `https://generativelanguage.googleapis.com/v1beta/models/gemini-2.5-flash-preview-09-2025:generateContent?key=${apiKey}`;

        // Dados do DRE de Outubro
        const financialData = `
            DRE - MÊS DE OUTUBRO
            
            RECEITAS:
            - Receita Bruta de Vendas: R$ 9.800,00
            - Descontos: R$ 0,00
            - Receita Líquida: R$ 9.800,00
            
            CUSTOS E MARGEM:
            - CPV (Custo Produtos Vendidos): R$ 3.800,00
            - Lucro Bruto: R$ 6.000,00
            
            DESPESAS OPERACIONAIS (Total R$ 4.000,00):
            1. Salários Fixos (Total R$ 3.600,00):
               - Maycon (Adm): R$ 600,00
               - Pierry (TI): R$ 600,00
               - Bernardo (Fin): R$ 600,00
               - Fernanda (Ops): R$ 600,00
               - Diogo (RH): R$ 600,00
               - Marcos (Mkt): R$ 600,00
            2. Custos Extras:
               - Frete: R$ 200,00
               - Materiais Extras: R$ 200,00
            
            RESULTADO:
            - Lucro Operacional: R$ 2.000,00
            - Impostos: R$ 0,00
            - Lucro Líquido do Exercício: R$ 2.000,00
            - Destino: Caixa da Empresa
        `;

        const systemPrompt = "Você é um consultor financeiro analisando o DRE (Demonstrativo do Resultado do Exercício) de uma empresa. Analise a saúde financeira com base nesses dados. Comente sobre a margem bruta (Lucro Bruto / Receita), o impacto dos custos fixos (Salários) versus custos variáveis e o resultado final líquido. Seja conciso e profissional.";
        
        const userQuery = `Analise este DRE de Outubro:\n${financialData}`;

        async function fetchWithBackoff(url, options, maxRetries = 5, baseDelay = 1000) {
            let attempt = 0;
            while (attempt < maxRetries) {
                try {
                    const response = await fetch(url, options);
                    if (response.ok || response.status !== 429) return response;
                } catch (error) {}
                const delay = baseDelay * Math.pow(2, attempt) + Math.random() * 1000;
                await new Promise(resolve => setTimeout(resolve, delay));
                attempt++;
            }
            return new Response(JSON.stringify({ error: "Falha na API" }), { status: 500 });
        }

        async function callGeminiAPI() {
            analysisResultDiv.innerHTML = '';
            loadingSpinner.classList.remove('hidden');
            generateBtn.disabled = true;
            generateBtn.textContent = 'Analisando...';

            const payload = {
                contents: [{ parts: [{ text: userQuery }] }],
                systemInstruction: { parts: [{ text: systemPrompt }] },
            };

            const options = {
                method: 'POST',
                headers: { 'Content-Type': 'application/json' },
                body: JSON.stringify(payload)
            };

            try {
                const response = await fetchWithBackoff(apiUrl, options);
                const result = await response.json();

                if (!response.ok || !result.candidates?.[0]?.content?.parts?.[0]?.text) {
                    throw new Error("Erro na resposta da IA.");
                }

                const rawText = result.candidates[0].content.parts[0].text;
                
                let formattedText = rawText
                    .split('\n\n')
                    .map(paragraph => {
                        if (paragraph.trim().startsWith('*') || paragraph.trim().startsWith('-')) {
                            const items = paragraph.split('\n')
                                .map(item => item.trim().replace(/^[\*\-]\s*/, ''))
                                .filter(item => item.length > 0)
                                .map(item => `<li class="ml-4 mb-1">${item}</li>`)
                                .join('');
                            return `<ul class="list-disc list-inside mb-4 text-slate-700 bg-slate-50 p-3 rounded">${items}</ul>`;
                        } else {
                            return `<p class="mb-3 text-justify">${paragraph.replace(/\n/g, '<br>')}</p>`;
                        }
                    })
                    .join('');

                analysisResultDiv.innerHTML = formattedText;

            } catch (error) {
                analysisResultDiv.innerHTML = `<p class="text-red-600">Erro: ${error.message}</p>`;
            } finally {
                loadingSpinner.classList.add('hidden');
                generateBtn.disabled = false;
                generateBtn.textContent = 'Gerar Análise Financeira';
            }
        }

        generateBtn.addEventListener('click', callGeminiAPI);
    </script>
</body>
</html>